"use strict";(self.webpackChunkdiabetes=self.webpackChunkdiabetes||[]).push([[9084],{2956:(L,I,c)=>{c.d(I,{e:()=>U});var v=c(5619),i=c(2096),u=c(7398),m=c(4664),b=c(6306),g=c(4716),y=c(553);class d extends Error{}d.prototype.name="InvalidTokenError";var S=c(5879),V=c(9862);const C=`${y.N.apiUrl}/auth`;let E=(()=>{class l{constructor(r){this.http=r}login(r,e){return this.http.post(`${C}/login`,{username:r,password:e})}getUserByToken(r){const e=new V.WM({Authorization:`Bearer ${r}`});return this.http.get(`${C}/profile`,{headers:e})}static#e=this.\u0275fac=function(e){return new(e||l)(S.LFG(V.eN))};static#t=this.\u0275prov=S.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var k=c(4190);let U=(()=>{class l{get currentUserValue(){return this.currentUserSubject.value}set currentUserValue(r){this.currentUserSubject.next(r)}constructor(r,e){this.authHttpService=r,this.router=e,this.unsubscribe=[],this.authLocalStorageToken=`${y.N.USERDATA_KEY}`,this.isLoadingSubject=new v.X(!1),this.currentUserSubject=new v.X(void 0),this.currentUser$=this.currentUserSubject.asObservable(),this.isLoading$=this.isLoadingSubject.asObservable();const t=this.getUserByToken().subscribe();this.unsubscribe.push(t)}login(r,e){return this.isLoadingSubject.next(!0),this.authHttpService.login(r,e).pipe((0,u.U)(t=>{const n=this.setAuthFromLocalStorage(t);return console.log("auth",t),console.log("login status",n),n}),(0,m.w)(()=>this.getUserByToken()),(0,b.K)(t=>(console.error("err",t),(0,i.of)(void 0))),(0,g.x)(()=>this.isLoadingSubject.next(!1)))}logout(){localStorage.removeItem(this.authLocalStorageToken),this.router.navigate(["/auth/login"],{queryParams:{}})}getUserByToken(){const r=this.getAuthFromLocalStorage();return r&&r.access_token?(this.isLoadingSubject.next(!0),this.authHttpService.getUserByToken(r.access_token).pipe((0,u.U)(e=>(e?this.currentUserSubject.next(e):this.logout(),e)),(0,g.x)(()=>this.isLoadingSubject.next(!1)))):(0,i.of)(void 0)}setAuthFromLocalStorage(r){return!(!r||!r.access_token||(localStorage.setItem(this.authLocalStorageToken,JSON.stringify(r)),0))}getAuthFromLocalStorage(){try{const r=localStorage.getItem(this.authLocalStorageToken);return r?JSON.parse(r):void 0}catch(r){return void console.error(r)}}checkUserUUID(){var e=this.getAuthFromLocalStorage()?.access_token;return this.getDecodedAccessToken(e).user_uuid}checkUserFullName(){var e=this.getAuthFromLocalStorage()?.access_token;return this.getDecodedAccessToken(e).username}checkUserStatusPatient(){var e=this.getAuthFromLocalStorage()?.access_token;return this.getDecodedAccessToken(e).status_patient}checkUserHospital(){var e=this.getAuthFromLocalStorage()?.access_token;return this.getDecodedAccessToken(e).hospital_name}getDecodedAccessToken(r){try{return function F(l,f){if("string"!=typeof l)throw new d("Invalid token specified: must be a string");f||(f={});const r=!0===f.header?0:1,e=l.split(".")[r];if("string"!=typeof e)throw new d(`Invalid token specified: missing part #${r+1}`);let t;try{t=function A(l){let f=l.replace(/-/g,"+").replace(/_/g,"/");switch(f.length%4){case 0:break;case 2:f+="==";break;case 3:f+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function _(l){return decodeURIComponent(atob(l).replace(/(.)/g,(f,r)=>{let e=r.charCodeAt(0).toString(16).toUpperCase();return e.length<2&&(e="0"+e),"%"+e}))}(f)}catch{return atob(f)}}(e)}catch(n){throw new d(`Invalid token specified: invalid base64 for part #${r+1} (${n.message})`)}try{return JSON.parse(t)}catch(n){throw new d(`Invalid token specified: invalid json for part #${r+1} (${n.message})`)}}(r)}catch{return null}}ngOnDestroy(){this.unsubscribe.forEach(r=>r.unsubscribe())}static#e=this.\u0275fac=function(e){return new(e||l)(S.LFG(E),S.LFG(k.F0))};static#t=this.\u0275prov=S.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},53:(L,I,c)=>{c.d(I,{vi:()=>r});var v=function e(){},i=c(5879),u=c(6814),m=function(){function e(t){this._ranScripts={},this._renderer=t.createRenderer(null,null)}return e.prototype.insertEl=function(t,n,s,o,a){if(o&&!a){var h=t._prevSVG&&t._prevSVG.parentNode;h&&this._renderer.removeChild(h,t._prevSVG),n.innerHTML=""}a?this._renderer.insertBefore(n,s,n.firstChild):this._renderer.appendChild(n,s),"svg"===s.nodeName&&(t._prevSVG=s)},e.prototype.evalScripts=function(t,n,s){for(var o=t.querySelectorAll("script"),a=[],h=0;h<o.length;h++){var p=o[h].getAttribute("type");p&&"application/ecmascript"!==p&&"application/javascript"!==p||(a.push(o[h].innerText||o[h].textContent),this._renderer.removeChild(o[h].parentNode,o[h]))}if(a.length>0&&("always"===s||"once"===s&&!this._ranScripts[n])){for(h=0;h<a.length;h++)new Function(a[h])(window);this._ranScripts[n]=!0}},e.\u0275fac=function(n){return new(n||e)(i.LFG(i.FYo))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),b=function(){function e(t,n){this._inlineSVGService=t,this._el=n}return e.prototype.ngAfterViewInit=function(){this._updateContent()},e.prototype.ngOnChanges=function(t){t.content&&this._updateContent()},e.prototype._updateContent=function(){this._inlineSVGService.insertEl(this.context,this._el.nativeElement,this.content,this.replaceContents,this.prepend)},e.\u0275fac=function(n){return new(n||e)(i.Y36(m),i.Y36(i.SBq))},e.\u0275cmp=i.Xpm({type:e,selectors:[["inline-svg"]],inputs:{context:"context",content:"content",replaceContents:"replaceContents",prepend:"prepend"},features:[i.TTD],decls:0,vars:0,template:function(n,s){},encapsulation:2,changeDetection:0}),e}(),g=c(9862),y=c(2096),d=c(8504),_=c(9397),A=c(6306),F=c(3020),S=c(7398),V=function(){function e(t,n,s,o,a,h){this._appBase=t,this._location=n,this._config=s,this._http=s&&!s.bypassHttpClientInterceptorChain?o:new g.eN(a),this._renderer=h.createRenderer(null,null),this.setBaseUrl(),e._cache||(e._cache=new Map),e._inProgressReqs||(e._inProgressReqs=new Map)}return e.prototype.getSVG=function(t,n,s){var o=this;void 0===s&&(s=!0);var a=(n?this.getAbsoluteUrl(t):t).replace(/#.+$/,"");if(s&&e._cache.has(a))return(0,y.of)(this._cloneSVG(e._cache.get(a)));if(e._inProgressReqs.has(a))return e._inProgressReqs.get(a);var h=this._http.get(a,{responseType:"text"}).pipe((0,_.b)(function(){e._inProgressReqs.delete(a)}),(0,A.K)(function(p){return e._inProgressReqs.delete(a),(0,d._)(p.message)}),(0,F.B)(),(0,S.U)(function(p){var G=o._svgElementFromString(p);return e._cache.set(a,G),o._cloneSVG(G)}));return e._inProgressReqs.set(a,h),h},e.prototype.setBaseUrl=function(){this._config?this._baseUrl=this._config.baseUrl:null!==this._appBase?this._baseUrl=this._appBase:null!==this._location&&(this._baseUrl=this._location.getBaseHrefFromDOM())},e.prototype.getAbsoluteUrl=function(t){this._baseUrl&&!/^https?:\/\//i.test(t)&&0===(t=this._baseUrl+t).indexOf("//")&&(t=t.substring(1));var n=this._renderer.createElement("BASE");return n.href=t,n.href},e.prototype._svgElementFromString=function(t){var n=this._renderer.createElement("DIV");n.innerHTML=t;var s=n.querySelector("svg");if(!s)throw new Error("No SVG found in loaded contents");return s},e.prototype._cloneSVG=function(t){return t.cloneNode(!0)},e.\u0275fac=function(n){return new(n||e)(i.LFG(u.mr,8),i.LFG(u.lw,8),i.LFG(v,8),i.LFG(g.eN),i.LFG(g.jN),i.LFG(i.FYo))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();function U(e,t){for(var n=0;n<t.length;n++)e.getAttribute(t[n])&&e.removeAttribute(t[n]);var o=e.getElementsByTagName("*");for(n=0;n<o.length;n++)U(o[n],t)}!function(){function e(t,n,s,o,a,h,p,G){this._el=t,this._viewContainerRef=n,this._resolver=s,this._svgCache=o,this._renderer=a,this._inlineSVGService=h,this._config=p,this.platformId=G,this.resolveSVGUrl=!0,this.replaceContents=!0,this.prepend=!1,this.injectComponent=!1,this.cacheSVG=!0,this.forceEvalStyles=!1,this.evalScripts="always",this.onSVGInserted=new i.vpe,this.onSVGFailed=new i.vpe,this._supportsSVG=function E(){return typeof SVGRect<"u"}(),!(0,u.PM)(this.platformId)&&!this._supportsSVG&&this._fail("Embed SVG are not supported by this browser")}e.prototype.ngOnInit=function(){!this._isValidPlatform()||this._isSSRDisabled()||this._insertSVG()},e.prototype.ngOnChanges=function(t){if(this._isValidPlatform()&&!this._isSSRDisabled()){var n=!!t.setSVGAttributes;(t.inlineSVG||n)&&this._insertSVG(n)}},e.prototype.ngOnDestroy=function(){this._subscription&&this._subscription.unsubscribe()},e.prototype._insertSVG=function(t){var n=this;if(void 0===t&&(t=!1),(0,u.PM)(this.platformId)||this._supportsSVG){if(!this.inlineSVG)return void this._fail("No URL passed to [inlineSVG]");!t&&this.inlineSVG===this._prevUrl||(this._prevUrl=this.inlineSVG,this._subscription=this._svgCache.getSVG(this.inlineSVG,this.resolveSVGUrl,this.cacheSVG).subscribe(function(s){if(function C(e){return"#"===e.charAt(0)||e.indexOf(".svg#")>-1}(n.inlineSVG)){var o=n.inlineSVG.split("#")[1];s=function k(e,t,n){var s=t.querySelector('[id="'.concat(n,'"]'));if(!s)throw new Error('Symbol "'.concat(n,'" not found'));var o=e.createElement("svg","svg");e.appendChild(o,s);var a=e.createElement("use","svg");return e.setAttribute(a,"href","#".concat(n),"xlink"),e.appendChild(o,a),o}(n._renderer,s,o)}n._processSvg(s)},function(s){n._fail(s)}))}},e.prototype._processSvg=function(t){if(t){if(this.removeSVGAttributes&&(0,u.NF)(this.platformId)&&U(t,this.removeSVGAttributes),this.setSVGAttributes&&function l(e,t){for(var n in t)e.setAttribute(n,t[n])}(t,this.setSVGAttributes),this.onSVGLoaded&&(t=this.onSVGLoaded(t,this._el.nativeElement)),this._insertEl(t),(0,u.NF)(this.platformId)&&this._inlineSVGService.evalScripts(t,this.inlineSVG,this.evalScripts),this.forceEvalStyles){var n=t.querySelectorAll("style");Array.from(n).forEach(function(s){return s.textContent+=""})}this.onSVGInserted.emit(t)}},e.prototype._insertEl=function(t){if(this.injectComponent){if(!this._svgComp){var n=this._resolver.resolveComponentFactory(b);this._svgComp=this._viewContainerRef.createComponent(n)}this._svgComp.instance.context=this,this._svgComp.instance.replaceContents=this.replaceContents,this._svgComp.instance.prepend=this.prepend,this._svgComp.instance.content=t,this._renderer.appendChild(this._el.nativeElement,this._svgComp.injector.get(b)._el.nativeElement)}else this._inlineSVGService.insertEl(this,this._el.nativeElement,t,this.replaceContents,this.prepend)},e.prototype._fail=function(t){if(this.onSVGFailed.emit(t),this.fallbackImgUrl){var n=this._renderer.createElement("IMG");this._renderer.setAttribute(n,"src",this.fallbackImgUrl),this._insertEl(n)}else this.fallbackSVG&&this.fallbackSVG!==this.inlineSVG&&(this.inlineSVG=this.fallbackSVG,this._insertSVG())},e.prototype._isValidPlatform=function(){return(0,u.PM)(this.platformId)||(0,u.NF)(this.platformId)},e.prototype._isSSRDisabled=function(){return(0,u.PM)(this.platformId)&&this._config&&this._config.clientOnly},e.\u0275fac=function(n){return new(n||e)(i.Y36(i.SBq),i.Y36(i.s_b),i.Y36(i._Vd),i.Y36(V),i.Y36(i.Qsj),i.Y36(m),i.Y36(v,8),i.Y36(i.Lbi))},e.\u0275dir=i.lG2({type:e,selectors:[["","inlineSVG",""]],inputs:{inlineSVG:"inlineSVG",resolveSVGUrl:"resolveSVGUrl",replaceContents:"replaceContents",prepend:"prepend",injectComponent:"injectComponent",cacheSVG:"cacheSVG",setSVGAttributes:"setSVGAttributes",removeSVGAttributes:"removeSVGAttributes",forceEvalStyles:"forceEvalStyles",evalScripts:"evalScripts",fallbackImgUrl:"fallbackImgUrl",fallbackSVG:"fallbackSVG",onSVGLoaded:"onSVGLoaded"},outputs:{onSVGInserted:"onSVGInserted",onSVGFailed:"onSVGFailed"},features:[i._Bn([V]),i.TTD]})}();var r=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:v,useValue:t}]}},e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=i.oAB({type:e}),e.\u0275inj=i.cJS({}),e}()}}]);