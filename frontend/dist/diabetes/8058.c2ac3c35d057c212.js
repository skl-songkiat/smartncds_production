"use strict";(self.webpackChunkdiabetes=self.webpackChunkdiabetes||[]).push([[8058],{8058:(A,f,s)=>{s.r(f),s.d(f,{PatientsLoginModule:()=>b});var p=s(6814),h=s(4190),n=s(6223),S=s(1374),U=s(685),e=s(5879),v=s(2956);const L=[{path:"",component:(()=>{class i{constructor(u,a,r,c){this.fb=u,this.authService=a,this.route=r,this.router=c,this.routes=U._,this.defaultAuth={username:"patients@demo.com",password:"demo"},this.unsubscribe=[],this.isLoading$=this.authService.isLoading$}ngOnInit(){this.initForm(),this.returnUrl=this.route.snapshot.queryParams["returnUrl".toString()]||"/login"}get field(){return this.loginForm?.controls}initForm(){this.loginForm=new n.cw({username:new n.NI("",n.kI.compose([n.kI.required,n.kI.minLength(3),n.kI.maxLength(320)])),password:new n.NI("",n.kI.compose([n.kI.required,n.kI.minLength(3),n.kI.maxLength(100)]))})}submit(){this.hasError=!1;const u=this.authService.login(this.field.username.value,this.field.password.value).pipe((0,S.P)()).subscribe(a=>{console.log("login sucess",a),a?this.router.navigate(["patients/patient-dashboard"]):(this.router.navigate(["login"]),this.hasError=!0)});this.unsubscribe.push(u)}static#t=this.\u0275fac=function(a){return new(a||i)(e.Y36(n.qu),e.Y36(v.e),e.Y36(h.gz),e.Y36(h.F0))};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-patients-login"]],decls:25,vars:1,consts:[[1,"content","top-space"],[1,"container-fluid"],[1,"row"],[1,"col-md-8","offset-md-2"],[1,"account-content"],[1,"row","align-items-center","justify-content-center"],[1,"col-md-7","col-lg-6","login-left"],["src","assets/img/bg/banner.png","alt","Patients Login",1,"img-fluid"],[1,"col-md-12","col-lg-6","login-right"],[1,"login-header"],[3,"formGroup"],["for","username",1,"focus-label"],[1,"mb-3","form-focus"],["type","username","name","username","formControlName","username","autocomplete","off",1,"form-control","bg-transparent"],["for","password",1,"focus-label"],["type","password","name","password","autocomplete","off","formControlName","password",1,"form-control","bg-transparent"],["type","button","tabindex","1",1,"btn","btn-primary","w-100","btn-lg","login-btn",3,"click"]],template:function(a,r){1&a&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),e._UZ(7,"img",7),e.qZA(),e.TgZ(8,"div",8)(9,"div",9)(10,"h3"),e._uU(11,"Login "),e.TgZ(12,"span"),e._uU(13,"Patients"),e.qZA()()(),e.TgZ(14,"form",10)(15,"label",11),e._uU(16,"Username"),e.qZA(),e.TgZ(17,"div",12),e._UZ(18,"input",13),e.qZA(),e.TgZ(19,"label",14),e._uU(20,"Password"),e.qZA(),e.TgZ(21,"div",12),e._UZ(22,"input",15),e.qZA(),e.TgZ(23,"button",16),e.NdJ("click",function(){return r.submit()}),e._uU(24,"Login"),e.qZA()()()()()()()()()),2&a&&(e.xp6(14),e.Q6J("formGroup",r.loginForm))},dependencies:[n._Y,n.Fj,n.JJ,n.JL,n.sg,n.u]})}return i})()}];let k=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=e.oAB({type:i});static#o=this.\u0275inj=e.cJS({imports:[h.Bz.forChild(L),h.Bz]})}return i})();var y=s(5683),g=s(2032);let b=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=e.oAB({type:i});static#o=this.\u0275inj=e.cJS({imports:[p.ez,k,n.UX,y.lN,g.c]})}return i})()},2956:(A,f,s)=>{s.d(f,{e:()=>a});var p=s(5619),h=s(2096),n=s(7398),S=s(4664),U=s(6306),e=s(4716),v=s(553);class d extends Error{}d.prototype.name="InvalidTokenError";var g=s(5879),b=s(9862);const i=`${v.N.apiUrl}/auth`;let T=(()=>{class r{constructor(t){this.http=t}login(t,o){return this.http.post(`${i}/login`,{username:t,password:o})}getUserByToken(t){const o=new b.WM({Authorization:`Bearer ${t}`});return this.http.get(`${i}/profile`,{headers:o})}static#t=this.\u0275fac=function(o){return new(o||r)(g.LFG(b.eN))};static#e=this.\u0275prov=g.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var u=s(4190);let a=(()=>{class r{get currentUserValue(){return this.currentUserSubject.value}set currentUserValue(t){this.currentUserSubject.next(t)}constructor(t,o){this.authHttpService=t,this.router=o,this.unsubscribe=[],this.authLocalStorageToken=`${v.N.USERDATA_KEY}`,this.isLoadingSubject=new p.X(!1),this.currentUserSubject=new p.X(void 0),this.currentUser$=this.currentUserSubject.asObservable(),this.isLoading$=this.isLoadingSubject.asObservable();const l=this.getUserByToken().subscribe();this.unsubscribe.push(l)}login(t,o){return this.isLoadingSubject.next(!0),this.authHttpService.login(t,o).pipe((0,n.U)(l=>{const m=this.setAuthFromLocalStorage(l);return console.log("auth",l),console.log("login status",m),m}),(0,S.w)(()=>this.getUserByToken()),(0,U.K)(l=>(console.error("err",l),(0,h.of)(void 0))),(0,e.x)(()=>this.isLoadingSubject.next(!1)))}logout(){localStorage.removeItem(this.authLocalStorageToken),this.router.navigate(["/auth/login"],{queryParams:{}})}getUserByToken(){const t=this.getAuthFromLocalStorage();return t&&t.access_token?(this.isLoadingSubject.next(!0),this.authHttpService.getUserByToken(t.access_token).pipe((0,n.U)(o=>(o?this.currentUserSubject.next(o):this.logout(),o)),(0,e.x)(()=>this.isLoadingSubject.next(!1)))):(0,h.of)(void 0)}setAuthFromLocalStorage(t){return!(!t||!t.access_token||(localStorage.setItem(this.authLocalStorageToken,JSON.stringify(t)),0))}getAuthFromLocalStorage(){try{const t=localStorage.getItem(this.authLocalStorageToken);return t?JSON.parse(t):void 0}catch(t){return void console.error(t)}}checkUserUUID(){var o=this.getAuthFromLocalStorage()?.access_token;return this.getDecodedAccessToken(o).user_uuid}checkUserFullName(){var o=this.getAuthFromLocalStorage()?.access_token;return this.getDecodedAccessToken(o).username}checkUserStatusPatient(){var o=this.getAuthFromLocalStorage()?.access_token;return this.getDecodedAccessToken(o).status_patient}checkUserHospital(){var o=this.getAuthFromLocalStorage()?.access_token;return this.getDecodedAccessToken(o).hospital_name}getDecodedAccessToken(t){try{return function y(r,c){if("string"!=typeof r)throw new d("Invalid token specified: must be a string");c||(c={});const t=!0===c.header?0:1,o=r.split(".")[t];if("string"!=typeof o)throw new d(`Invalid token specified: missing part #${t+1}`);let l;try{l=function k(r){let c=r.replace(/-/g,"+").replace(/_/g,"/");switch(c.length%4){case 0:break;case 2:c+="==";break;case 3:c+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function L(r){return decodeURIComponent(atob(r).replace(/(.)/g,(c,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(c)}catch{return atob(c)}}(o)}catch(m){throw new d(`Invalid token specified: invalid base64 for part #${t+1} (${m.message})`)}try{return JSON.parse(l)}catch(m){throw new d(`Invalid token specified: invalid json for part #${t+1} (${m.message})`)}}(t)}catch{return null}}ngOnDestroy(){this.unsubscribe.forEach(t=>t.unsubscribe())}static#t=this.\u0275fac=function(o){return new(o||r)(g.LFG(T),g.LFG(u.F0))};static#e=this.\u0275prov=g.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})()}}]);